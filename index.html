<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <title>ä¸Šæµ·æ™¯ç‚¹çƒ­åŠ›å›¾ä¸åˆ†ç±»æ ‡è®°</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- é«˜å¾·åœ°å›¾API -->
    <style>
        #map { width: 100%; height: 100vh; }
    </style>
    <script src="https://webapi.amap.com/loader.js"></script>
    <style>
        html, body, #map {
            height: 100%;
            margin: 0;
            padding: 0;
        }
        .custom-marker {
            width: 32px;
            height: 32px;
            background-size: cover;
            border-radius: 50%;
        }
        /* å¼¹çª—è‡ªå®šä¹‰æ ·å¼ */
        .amap-info-content {
            padding: 12px !important;
            min-width: 280px;
            border-radius: 8px !important;
        }
        .info-image {
            width: 100%;
            height: 160px;
            object-fit: cover;
            border-radius: 6px;
            margin-bottom: 8px;
        }
        .info-title {
            font-size: 16px;
            margin: 6px 0;
            color: #333;
        }
        .info-desc {
            font-size: 12px;
            color: #666;
            line-height: 1.6;
            margin: 8px 0;
        }
        .info-weather {
            color: #1890ff;
            font-weight: bold;
        }
        
        /* æ–°å¢æ§åˆ¶æ æ ·å¼ */
        #controlBar {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 999;
            background: rgba(255,255,255,0.9);
            padding: 12px;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }
        .mode-switch {
            margin-bottom: 10px;
        }
        .query-group {
            display: none; /* é»˜è®¤éšè—æŸ¥è¯¢æ¡ä»¶ */
            margin-top: 8px;
        }
        .query-group.active {
            display: block;
        }
        .query-item {
            margin: 6px 0;
        }
        select, button {
            padding: 6px;
            margin: 2px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
	    
	#routeOptions {
	  margin-top: 12px;
	}
	
	.route-option {
	  padding: 8px;
	  margin: 6px 0;
	  border: 1px solid #ddd;
	  border-radius: 4px;
	  cursor: pointer;
	}
	
	.route-option:hover {
	  background: #f5f5f5;
	}
	
	.route-step {
	  padding: 8px;
	  background: #f8f9fa;
	  border-radius: 4px;
	  margin: 6px 0;
	}
        
    </style>
</head>
<body>
    <div id="controlBar">
        <div class="mode-switch">
            <button onclick="switchMode('realtime')">å®æ—¶æ¨¡å¼</button>
            <button onclick="switchMode('query')">æŸ¥è¯¢æ¨¡å¼</button>
	    <button onclick="switchMode('route')">è·¯çº¿æ¨¡å¼</button>
        </div>
	    
        <div id="routeConditions" class="query-group">
	<div class="query-item">
	    <select id="routeSelect" onchange="selectDestination()">
	    <option value="">è¯·é€‰æ‹©ç›®çš„åœ°</option>
	    <!-- åŠ¨æ€å¡«å……é€‰é¡¹ -->
	    </select>
	  </div>
	  <div id="routeOptions"></div>
	  <div id="routeDetails"></div>
	</div>
        
        <div id="queryConditions" class="query-group">
            <div class="query-item">
                <input type="date" id="queryDate" placeholder="é€‰æ‹©æ—¥æœŸ">
            </div>
            <div class="query-item">
                <select id="timeRange">
                    <option value="8-10">8:00-10:00</option>
                    <option value="10-12">10:00-12:00</option>
                    <option value="12-14">12:00-14:00</option>
                    <option value="14-16">14:00-16:00</option>
                    <option value="16-18">16:00-18:00</option>
                </select>
            </div>
            <div class="query-item">
                <select id="tagSelect">
                    <option value="å…¨éƒ¨">å…¨éƒ¨ç±»å‹</option>
                    <option value="åœ°æ ‡æ™¯ç‚¹">åœ°æ ‡æ™¯ç‚¹</option>
                    <option value="å•†ä¸šä¼‘é—²">å•†ä¸šä¼‘é—²</option>
                    <option value="æ–‡åŒ–å†å²">æ–‡åŒ–å†å²</option>
                    <option value="å…¬å…±ç©ºé—´">å…¬å…±ç©ºé—´</option>
                </select>
            </div>
            <button onclick="executeQuery()">æŸ¥è¯¢</button>
        </div>
    </div>

    <div id="map"></div>
    
    <script>
        // å…¨å±€å˜é‡å­˜å‚¨åœ°å›¾å’Œçƒ­åŠ›å›¾å®ä¾‹
        let map, heatmap;
        let routePolyline;
        // æ–°å¢å…¨å±€å˜é‡
        let currentMode = 'realtime'; // å½“å‰æ¨¡å¼
        let refreshInterval; // å­˜å‚¨å®šæ—¶å™¨
        // æ–°å¢å…¨å±€å˜é‡å­˜å‚¨AMapå®ä¾‹
        let AMapInstance;
        let allLocations;
        
	// é¢„å®šä¹‰åœ°é“çº¿è·¯æ•°æ®
	const metroLines = {
	  "æ–¹æ¡ˆä¸€": {
	    steps: [
	      "æ­¥è¡Œ327ç±³åˆ°è¾¾ä¸Šæµ·å—ç«™",
	      "ä¹˜ååœ°é“1å·çº¿ï¼ˆå¯Œé”¦è·¯æ–¹å‘ï¼‰8ç«™åˆ°äººæ°‘å¹¿åœºç«™",
	      "æ¢ä¹˜åœ°é“2å·çº¿ï¼ˆæµ¦ä¸œå›½é™…æœºåœºæ–¹å‘ï¼‰1ç«™åˆ°å—äº¬ä¸œè·¯ç«™",
	      "æ­¥è¡Œ598ç±³åˆ°è¾¾å¤–æ»©"
	    ],
	    time: "28åˆ†é’Ÿ",
	    distance: "11.2å…¬é‡Œ",
	    cost: "4å…ƒ",
	    path: [
	      [121.4305, 31.1547], // ä¸Šæµ·å—ç«™
	      [121.4752, 31.2356], // äººæ°‘å¹¿åœº
	      [121.4904, 31.2415]  // å¤–æ»©
	    ]
	  }
	};

	// åˆå§‹åŒ–è·¯çº¿æ¨¡å¼
	function initRouteMode() {
	  const sel = document.getElementById('routeSelect');
	  sel.innerHTML = '<option value="">è¯·é€‰æ‹©ç›®çš„åœ°</option>';
	  allLocations.forEach(loc => {
	    sel.innerHTML += `<option value="${loc.name}">${loc.name}</option>`;
	  });
	}
	
	// ç›®çš„åœ°é€‰æ‹©å¤„ç†
	function selectDestination() {
	  const destName = document.getElementById('routeSelect').value;
	  const destination = allLocations.find(loc => loc.name === destName);
	  
	  if (destName === "å¤–æ»©") {
	    showRouteOptions();
	    drawRoute(metroLines["æ–¹æ¡ˆä¸€"].path);
	  }
	}
	
	// ç»˜åˆ¶è·¯çº¿
	function drawRoute(path) {
	  if (routePolyline) routePolyline.setMap(null);
	  
	  routePolyline = new AMapInstance.Polyline({
	    path: path,
	    strokeColor: "#1890ff",
	    strokeWeight: 4,
	    map: map
	  });
	  
	  map.setFitView();
	}
	
	// æ˜¾ç¤ºè·¯çº¿é€‰é¡¹
	function showRouteOptions() {
	  const container = document.getElementById('routeOptions');
	  container.innerHTML = Object.keys(metroLines).map(name => `
	    <div class="route-option" onclick="showRouteDetails('${name}')">
	      <div>${name}</div>
	      <div style="color:#666;font-size:12px">
	        ${metroLines[name].time} | ${metroLines[name].distance} | ${metroLines[name].cost}
	      </div>
	    </div>
	  `).join('');
	}
	
	// æ˜¾ç¤ºè¯¦ç»†è·¯çº¿
	function showRouteDetails(routeName) {
	  const container = document.getElementById('routeDetails');
	  container.innerHTML = `
	    <div style="margin:12px 0;color:#333">å…·ä½“è·¯çº¿ï¼š</div>
	    ${metroLines[routeName].steps.map(step => `
	      <div class="route-step">${step}</div>
	    `).join('')}
	  `;
	}

	
        function initMap() {
            AMapLoader.load({
                key: "8ba0c9149f5807a5aa8d60915f94aa7f",
                version: "2.0",
                plugins: ['AMap.HeatMap', 'AMap.Marker']
            }).then((AMap) => {
                AMapInstance = AMap; // å­˜å‚¨AMapå®ä¾‹
                map = new AMap.Map('map', {
                    viewMode: '2D',
                    center: [121.4737, 31.2304],
                    zoom: 12
                });

                
                // åˆå§‹åŒ–çƒ­åŠ›å›¾
                initHeatmap(AMap);
                
                // åˆå§‹åŒ–åˆ†ç±»æ ‡è®°
                initMarkers(AMap);
		    
                // å¯åŠ¨å®šæ—¶åˆ·æ–°
                // ä¿®æ”¹å®šæ—¶å™¨å­˜å‚¨æ–¹å¼ï¼ˆåŸæœ‰ä»£ç ä¿®æ”¹ï¼‰
                refreshInterval = setInterval(() => refreshHeatmap(AMap), 5000);
		    
		 initRouteMode();
		    
            }).catch(e => {
                console.error("åœ°å›¾åŠ è½½å¤±è´¥:", e);
            });
        }

         // æ–°å¢æ¨¡å¼åˆ‡æ¢å‡½æ•°
        function switchMode(mode) {
            currentMode = mode;
	    const queryGroup = document.getElementById('queryConditions');
 	    const routeGroup = document.getElementById('routeConditions');
            const queryGroup = document.getElementById('queryConditions');
            const routeGroup = document.getElementById('routeConditions');
            if (mode === 'query') {
                queryGroup.classList.add('active');
                routeGroup.classList.remove('active');
                clearInterval(refreshInterval); // åœæ­¢å®æ—¶åˆ·æ–°
            } 
	    if (mode === 'realtime') {
                queryGroup.classList.remove('active');
                // æ¢å¤å®æ—¶åˆ·æ–°ï¼ˆåŸæœ‰ä»£ç ä¿®æ”¹ï¼‰
                refreshInterval = setInterval(() => refreshHeatmap(AMap), 5000);
                heatmap.setDataSet({data: generateHeatmapData(), max: 100});
                routeGroup.classList.remove('active');
            }
            if (mode === 'route') {
	    routeGroup.classList.add('active');
	    queryGroup.classList.remove('active');
	    clearInterval(refreshInterval);
	    initRouteMode();
	  }
	}

        // æ–°å¢æŸ¥è¯¢æ‰§è¡Œå‡½æ•°
        function executeQuery() {
            const selectedType = document.getElementById('tagSelect').value;
            // åŸºäºå…¨å±€ allLocations è¿‡æ»¤å¹¶ç”Ÿæˆä¸€æ¬¡æ€§çƒ­åŠ›å›¾æ•°æ®
            const queryData = allLocations
                .filter(loc => selectedType === 'å…¨éƒ¨' || loc.type === selectedType)
                .map(loc => ({
                    lng: loc.lng,
                    lat: loc.lat,
                    count: Math.min(100, Math.floor(Math.random() * 120))
                }));

            // åˆ‡æ¢ï¼ˆé‡æ–°æ¸²æŸ“ï¼‰çƒ­åŠ›å›¾
            heatmap.setDataSet({
                data: queryData,
                max: 100
            });
        }
        
        function initHeatmap(AMap) {
            // çƒ­åŠ›å›¾æ•°æ®
            const heatmapData = generateHeatmapData();
            
            // åˆ›å»ºçƒ­åŠ›å›¾
            heatmap = new AMap.HeatMap(map, {
                radius: 40,
                opacity: [0.6, 0.8],
                gradient: {
                    0.4: 'blue',
                    0.6: 'cyan',
                    0.7: 'lime',
                    0.8: 'yellow',
                    1.0: 'red'
                },
                zooms: [3, 18]
            });
            
            heatmap.setDataSet({
                data: heatmapData,
                max: 100
            });
        }

        async function initMarkers(AMap) {
            const icons = {
                'åœ°æ ‡æ™¯ç‚¹': 'https://cdn-icons-png.flaticon.com/128/18499/18499155.png',
                'å•†ä¸šä¼‘é—²': 'https://cdn-icons-png.flaticon.com/128/11030/11030893.png',
                'æ–‡åŒ–å†å²': 'https://cdn-icons-png.flaticon.com/128/2346/2346307.png',
                'å…¬å…±ç©ºé—´': 'https://cdn-icons-png.flaticon.com/128/2169/2169407.png',
            };

            const locations = [
                { name: "å¤–æ»©", lat: 31.2415, lng: 121.4904, type: "åœ°æ ‡æ™¯ç‚¹",
                 photo: "https://unsplash.com/photos/orient-pearl-shanghai-china-taken-during-daytime-uKyzXEc2k_s?utm_content=creditShareLink&utm_medium=referral&utm_source=unsplash",
                 desc: "ä¸Šæµ·æœ€å…·ä»£è¡¨æ€§çš„æ»¨æ±Ÿæ™¯è§‚å¸¦ï¼Œæ±‡é›†52å¹¢é£æ ¼è¿¥å¼‚çš„å†å²å»ºç­‘ç¾¤ï¼Œè¢«èª‰ä¸º'ä¸‡å›½å»ºç­‘åšè§ˆ'ï¼Œå¤œæ™šç¯å…‰ç’€ç’¨çš„é»„æµ¦æ±Ÿæ™¯æ›´æ˜¯ä¸å¯é”™è¿‡ã€‚" },
                { name: "å—äº¬è·¯æ­¥è¡Œè¡—", lat: 31.2356, lng: 121.4752, type: "å•†ä¸šä¼‘é—²",
                 photo: "https://unsplash.com/photos/people-standing-near-gray-concrete-tower-D7InODIWyK4",
                 desc: "ä¸­å›½ç¬¬ä¸€æ¡å•†ä¸šæ­¥è¡Œè¡—ï¼Œå…¨é•¿1.2å…¬é‡Œï¼Œäº‘é›†ç™¾å¹´è€å­—å·ä¸å›½é™…å“ç‰Œï¼Œéœ“è™¹ç¯ç‰Œä¸å¤å¤é“›é“›è½¦äº¤ç»‡å‡ºç‹¬ç‰¹çš„æµ·æ´¾å•†ä¸šé£æƒ…ã€‚" },
                { name: "è±«å›­", lat: 31.2279, lng: 121.4873, type: "æ–‡åŒ–å†å²",
                 photo: "https://unsplash.com/photos/a-group-of-people-walking-down-a-street-next-to-tall-buildings-hBnPklsOzgg",
                 desc: "å§‹å»ºäºæ˜ä»£çš„æ±Ÿå—å¤å…¸å›­æ—ï¼Œå›­å†…äº­å°æ¥¼é˜é”™è½æœ‰è‡´ï¼Œä¹æ›²æ¡¥ä¸æ¹–å¿ƒäº­ç›¸æ˜ æˆè¶£ï¼Œæ¯—é‚»çš„åŸéšåº™å•†åœˆæ›´å¯ä½“éªŒä¼ ç»Ÿå¸‚é›†æ–‡åŒ–ã€‚"},
                { name: "ä¸Šæµ·åšç‰©é¦†", lat: 31.2304, lng: 121.4737, type: "æ–‡åŒ–å†å²",
                 photo: "https://unsplash.com/photos/the-modern-architecture-features-a-grand-entrance-JFnwXWuCObo",
                 desc: "ä¸­å›½å››å¤§åšç‰©é¦†ä¹‹ä¸€ï¼Œé’é“œå™¨é¦†ã€é™¶ç“·é¦†å’Œä¹¦ç”»é¦†çè—12ä¸‡ä»¶æ–‡ç‰©ï¼Œå»ºç­‘é€ å‹å¯“æ„'å¤©åœ†åœ°æ–¹'ï¼Œå±•ç°ä¸­åäº”åƒå¹´æ–‡æ˜ç²¾é«“ã€‚"},
                { name: "äººæ°‘å¹¿åœº", lat: 31.2328, lng: 121.4761, type: "å…¬å…±ç©ºé—´",
                 photo: "https://cdn.pixabay.com/photo/2018/07/15/23/22/prague-3540883_1280.jpg",
                 desc: "ä¸Šæµ·åœ°ç†ä¸æ”¿æ²»æ–‡åŒ–ä¸­å¿ƒï¼Œç™½é¸½é£èˆçš„å¹¿åœºã€æ¢å¼˜çš„å¸‚æ”¿å¤§å¦ä¸åœ°ä¸‹'åŸå¸‚ä¹‹å¿ƒ'åšç‰©é¦†å…±åŒæ„æˆå¸‚æ°‘ä¼‘é—²æ ¸å¿ƒåŒºã€‚"},
                { name: "ä¸Šæµ·å¤§å‰§é™¢", lat: 31.2319, lng: 121.4756, type: "æ–‡åŒ–å†å²",
                 photo: "https://dimg04.c-ctrip.com/images/02Y59120009dkqvkiF704_R_1080_808_Q90.jpg",
                 desc: "æ°´æ™¶å®«èˆ¬çš„ç°ä»£å»ºç­‘æ°ä½œï¼Œå¼§å½¢å±‹é¡¶è±¡å¾è‰ºæœ¯ä¹‹ç¿¼ï¼Œå¸¸å¹´ä¸Šæ¼”æ­Œå‰§ã€èŠ­è•¾ç­‰é«˜ç«¯æ¼”å‡ºï¼Œå¤œæ™šç»ç’ƒå¹•å¢™æµå…‰æº¢å½©ã€‚"},
                { name: "ç”°å­åŠ", lat: 31.2076, lng: 121.4692, type: "å•†ä¸šä¼‘é—²",
                 photo: "https://images.unsplash.com/photo-1670222023763-4072ad0e9a8b?q=80&w=2187&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",
                 desc: "çŸ³åº“é—¨å¼„å ‚æ”¹é€ çš„è‰ºæœ¯è¡—åŒºï¼Œ200ä½™å®¶åˆ›æ„åº—é“ºéšåŒ¿äºçº¢ç –ç°ç“¦ä¹‹é—´ï¼Œç”»å»Šã€æ‰‹ä½œå·¥åŠä¸å’–å•¡é¦†è¯ é‡Šæ–°è€ä¸Šæµ·çš„äº¤èã€‚"},
                { name: "æ–°å¤©åœ°", lat: 31.2186, lng: 121.4758, type: "å•†ä¸šä¼‘é—²",
                 photo: "https://images.unsplash.com/photo-1558688460-d35215366eca?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",
                 desc: "çŸ³åº“é—¨å»ºç­‘ä¸ç°ä»£å•†ä¸šå®Œç¾èåˆçš„æ—¶å°šåœ°æ ‡ï¼Œä¸­å…±ä¸€å¤§ä¼šå€åè½äºæ­¤ï¼Œå›½é™…é¤é¥®ä¸å¥¢ä¾ˆå“åº—æ‰“é€ é«˜ç«¯ä¼‘é—²ä½“éªŒã€‚"},
                { name: "å¤–ç™½æ¸¡æ¡¥", lat: 31.2442, lng: 121.4911, type: "åœ°æ ‡æ™¯ç‚¹",
                 photo: "https://plus.unsplash.com/premium_photo-1733306520547-1ffd55596459?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",
                 desc: "ä¸­å›½ç¬¬ä¸€åº§å…¨é’¢ç»“æ„æ¡¥æ¢ï¼Œç™¾å¹´å†å²è§è¯äº†ä¸Šæµ·å˜è¿ï¼Œã€Šæƒ…æ·±æ·±é›¨æ¿›æ¿›ã€‹ç­‰å½±è§†ç»å…¸å–æ™¯åœ°ï¼Œå¤œæ™šç¯å…‰å‹¾å‹’é“è‰ºä¹‹ç¾ã€‚"},
                { name: "ä¸Šæµ·åŸå¸‚è§„åˆ’é¦†", lat: 31.2341, lng: 121.4742, type: "åœ°æ ‡æ™¯ç‚¹",
                 photo: "https://img.d-arts.cn/grab_img/e73778c35c02e635e4b15589d934d3dc1644654711.jpeg",
                 desc: "é€šè¿‡å·¨å‹åŸå¸‚æ¨¡å‹ä¸æ•°å­—æ²™ç›˜å±•ç°ä¸Šæµ·ç™¾å¹´å˜è¿ï¼Œé¡¶å±‚360åº¦ç¯å¹•å½±é™¢å¸¦æ‚¨ç©¿è¶Šæœªæ¥åŸå¸‚å¤©é™…çº¿ã€‚"},
                { name: "äº‘å—å—è·¯ç¾é£Ÿè¡—", lat: 31.2225, lng: 121.4793, type: "å•†ä¸šä¼‘é—²",
                 photo: "https://images.unsplash.com/photo-1729301919282-a86a6904c1f1?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",
                 desc: "ç™¾å¹´ç¾é£Ÿä¸€æ¡è¡—ï¼Œå°ç»å…´ç™½æ–©é¸¡ã€é²œå¾—æ¥æ’éª¨å¹´ç³•ç­‰è€å­—å·äº‘é›†ï¼Œæ˜¯ä½“éªŒä¸Šæµ·æœ¬å¸®å°åƒä¸å¤œå¸‚æ–‡åŒ–çš„ç»ä½³å»å¤„ã€‚"},
                { name: "æ€å—å…¬é¦†", lat: 31.2143, lng: 121.4708, type: "æ–‡åŒ–å†å²",
                 photo: "https://unsplash.com/photos/a-stone-building-with-a-staircase-leading-up-to-it-eT_OIisTwPE",
                 desc: "51æ ‹èŠ±å›­æ´‹æˆ¿ç»„æˆçš„éœ²å¤©å»ºç­‘åšç‰©é¦†ï¼Œéƒ­æ²«è‹¥ã€æ¢…å…°èŠ³ç­‰åäººæ›¾å±…äºæ­¤ï¼Œç°ä¸ºèåˆä¹¦åº—ã€ç”»å»Šçš„æ–‡è‰ºç”Ÿæ´»ç©ºé—´ã€‚"},
                { name: "é™å®‰å¯º", lat: 31.2231, lng: 121.4465, type: "åœ°æ ‡æ™¯ç‚¹",
                 photo: "https://unsplash.com/photos/an-aerial-view-of-a-city-with-tall-buildings-IOshyMMATY0?utm_content=creditShareLink&utm_medium=referral&utm_source=unsplash",
                 desc: "æ²ªä¸Šæœ€å¤è€çš„ä½›å¯ºï¼Œé‡‘é¡¶æœ±å¢™çš„å®‹ä»£å»ºç­‘é£æ ¼ä¸å‘¨è¾¹æ‘©å¤©å¤§æ¥¼å½¢æˆéœ‡æ’¼å¯¹æ¯”ï¼Œæ¯é€¢æ³•ä¼šé’Ÿé¼“é½é¸£é¦™ç«ç¼­ç»•ã€‚"},
                { name: "å—äº¬è¥¿è·¯å•†åœˆ", lat: 31.2309, lng: 121.4598, type: "å•†ä¸šä¼‘é—²",
                 photo: "https://unsplash.com/photos/busy-street-scene-in-a-city-with-signs-and-vehicles-uaOvlQvECik?utm_content=creditShareLink&utm_medium=referral&utm_source=unsplash",
                 desc: "å¥¢ä¾ˆå“æ——èˆ°åº—æ—ç«‹çš„é»„é‡‘å•†ä¸šå¸¦ï¼Œæ’éš†å¹¿åœºã€ä¸­ä¿¡æ³°å¯Œç­‰é«˜ç«¯å•†åœºä¸å†å²å»ºç­‘å…±ç”Ÿï¼Œå±•ç°ä¸Šæµ·å›½é™…åŒ–å•†ä¸šé­…åŠ›ã€‚" },
                { name: "å…´ä¸šå¤ªå¤æ±‡", lat: 31.2287, lng: 121.4602, type: "å•†ä¸šä¼‘é—²",
                 photo: "https://img1.jiemian.com/101/original/20180426/152470756562359000.jpg",
                 desc: "èåˆå†å²å»ºç­‘'æŸ¥å…¬é¦†'çš„ç°ä»£å•†ä¸šç»¼åˆä½“ï¼Œ200ä½™å®¶å›½é™…å“ç‰Œä¸ç±³å…¶æ—é¤å…æ±‡èšï¼Œå±‹é¡¶èŠ±å›­å¯ä¿¯ç°å—äº¬è¥¿è·¯ç¹åè¡—æ™¯ã€‚"},
                { name: "å¼ å›­", lat: 31.2254, lng: 121.4546, type: "æ–‡åŒ–å†å²",
                 photo: "https://mediabluk.cnr.cn/img/cnr/CNRCDP/2022/1206/650d24374057c167030962299865535411.jpg?auth=1f4b31187191e69433549709815a38d6",
                 desc: "ä¸Šæµ·ç°å­˜è§„æ¨¡æœ€å¤§çš„çŸ³åº“é—¨å»ºç­‘ç¾¤ï¼Œ28æ¡å¼„å ‚ä¿å­˜å®Œæ•´ï¼Œæ”¹é€ åæˆä¸ºèåˆæµ·æ´¾æ–‡åŒ–å±•è§ˆä¸æ²‰æµ¸å¼ä½“éªŒçš„å†å²è¡—åŒºã€‚"},
                { name: "é©¬å‹’åˆ«å¢…", lat: 31.2332, lng: 121.4519, type: "æ–‡åŒ–å†å²",
                 photo: "https://dimg04.c-ctrip.com/images/02Y1m12000alnsea6EF49_R_1080_808_Q90.jpg",
                 desc: "æŒªå¨ç«¥è¯åŸå ¡å¼å»ºç­‘ï¼Œå› å¥³å„¿æ¢¦å¢ƒè€Œå»ºçš„ä¼ å¥‡ç§å®…ï¼Œå°–å¡”å½©çª—ä¸ä¸­å¼ç‰ç’ƒç“¦ç¢°æ’å‡ºç‹¬ç‰¹ç¾å­¦ï¼Œç°ä¸ºç²¾å“é…’åº—ä¸é¤å…ã€‚"},
                { name: "é™å®‰é›•å¡‘å…¬å›­", lat: 31.2278, lng: 121.4501, type: "å…¬å…±ç©ºé—´",
                 photo: "https://unsplash.com/photos/a-large-statue-in-a-park-S_5Rlr7zGUg?utm_content=creditShareLink&utm_medium=referral&utm_source=unsplash",
                 desc: "ä¸­å›½é¦–åº§ä¸“ä¸šé›•å¡‘å…¬å›­ï¼Œ60ä½™ä»¶ç°ä»£è‰ºæœ¯ä½œå“æ•£è½æ—è«ç»¿åœ°ï¼Œæ˜¥å­£æ¨±èŠ±å¤§é“ä¸ç§‹å­£é“¶ææ™¯è§‚å¸å¼•ä¼—å¤šæ‘„å½±çˆ±å¥½è€…ã€‚"},
                { name: "å¤§æ‚¦åŸ", lat: 31.2396, lng: 121.4483, type: "å•†ä¸šä¼‘é—²",
                 photo: "https://sghimages.shobserver.com/img/catch/2022/07/29/38c83845-2c5b-45b0-8e09-5d528d493ed3.jpg",
                 desc: "è‹æ²³æ¹¾ç•”çš„ç½‘çº¢å•†ä¸šåœ°æ ‡ï¼Œå±‹é¡¶æ‘©å¤©è½®'Sky Ring'å¯ä¿¯ç°è‹å·æ²³ï¼ŒäºŒæ¬¡å…ƒä¸»é¢˜è¡—åŒºä¸æ½®æµåº—é“ºå¸å¼•å¹´è½»æ¶ˆè´¹ç¾¤ä½“ã€‚"},
                { name: "å´æ±Ÿè·¯æ­¥è¡Œè¡—", lat: 31.2315, lng: 121.4624, type: "å•†ä¸šä¼‘é—²",
                 photo: "https://img1.qunarzz.com/travel/d4/1703/e8/fb4c098e92c846b5.jpg",
                 desc: "å—äº¬è¥¿è·¯åè¡—çš„ç¾é£Ÿå¤©å ‚ï¼Œå°æ¨ç”Ÿç…ã€çº¢å®çŸ³è›‹ç³•ç­‰ç½‘çº¢åº—äº‘é›†ï¼Œéœ“è™¹ç¯ç‰Œä¸‹çš„çƒŸç«æ°”å±•ç°å¸‚äº•ä¸Šæµ·é­…åŠ›ã€‚"},
                { name: "ä¸Šæµ·è‡ªç„¶åšç‰©é¦†", lat: 31.2375, lng: 121.4583, type: "åœ°æ ‡æ™¯ç‚¹",
                 photo: "https://ts1.tc.mm.bing.net/th/id/R-C.33ab62bfac76647e0e82ead80ac3f6bb?rik=lDCjexJoIB7OLg&riu=http%3a%2f%2fimgbdb3.bendibao.com%2fshbdb%2ftour%2f20215%2f26%2f2021526155554_31632.jpg&ehk=a6%2fPSnlFJgdQFmgMKIkw9xYTx2FrP6QMD75Qp3rbzrQ%3d&risl=&pid=ImgRaw&r=0",
                 desc: "å…¨çƒæœ€å¤§è‡ªç„¶åšç‰©é¦†ä¹‹ä¸€ï¼Œ10ä¸ªå¸¸è®¾å±•åŒºå±•å‡º1.1ä¸‡ä½™ä»¶æ ‡æœ¬ï¼Œå·¨å‹é©¬é—¨æºªé¾™éª¨æ¶ä¸æ´»ä½“å…»æ®–åŒºæœ€å—äº²å­å®¶åº­å–œçˆ±ã€‚"},
                { name: "å¾å®¶æ±‡å•†åœˆ", lat: 31.1956, lng: 121.4380, type: "å•†ä¸šä¼‘é—²",
                 photo: "https://ts1.tc.mm.bing.net/th/id/R-C.3a8dc33d0164cd926b00f27163e1a887?rik=Z1M8KVNIQT%2bZhw&riu=http%3a%2f%2fn.sinaimg.cn%2fsinakd20123%2f548%2fw1080h1068%2f20220114%2f4e0a-06ca544d84d4324a3914f98af4e76fea.jpg&ehk=MVnYu2ESR6srgC16LVdUpgDChSWORDbeky5XbjHUIPM%3d&risl=&pid=ImgRaw&r=0",
                 desc: "ä¸Šæµ·è¥¿å—éƒ¨å•†ä¸šæ ¸å¿ƒï¼Œæ¸¯æ±‡æ’éš†ã€ç¾ç½—åŸç­‰å…«å¤§å•†åœºç»„æˆç«‹ä½“å•†ä¸šçŸ©é˜µï¼Œç©ºä¸­è¿å»Šå®ç°å…¨å¤©å€™è´­ç‰©ä½“éªŒã€‚"},
                { name: "ä¸Šæµ·å›¾ä¹¦é¦†", lat: 31.2098, lng: 121.4412, type: "å…¬å…±ç©ºé—´",
                 photo: "https://youimg1.c-ctrip.com/target/1007170000011vemyBA7F.jpg",
                 desc: "å¹´æ¥å¾…è¯»è€…400ä¸‡äººæ¬¡çš„æ™ºæ…§å›¾ä¹¦é¦†ï¼Œç«¹æ—åº­é™¢ä¸æ•°å­—åŒ–é˜…è¯»åŒºå¹¶å­˜ï¼Œå®šæœŸä¸¾åŠæ–‡åŒ–è®²åº§ä¸å¤ç±ç‰¹å±•ã€‚"},
                { name: "é¾™åå¯º", lat: 31.1729, lng: 121.4493, type: "åœ°æ ‡æ™¯ç‚¹",
                 photo: "https://youimg1.c-ctrip.com/target/100u190000016303d82A7.jpg",
                 desc: "ä¸Šæµ·å†å²æœ€æ‚ ä¹…çš„å¤åˆ¹ï¼Œ'é¾™åæ™šé’Ÿ'è¢«èª‰ä¸ºæ²ªåŸå…«æ™¯ä¹‹ä¸€ï¼Œæ–°æ˜¥ç¥ˆç¦ä¸æ¸…æ˜åº™ä¼šä¼ æ‰¿åƒå¹´ä½›æ•™æ–‡åŒ–ã€‚"},
                { name: "æ­¦åº·è·¯å†å²æ–‡åŒ–è¡—", lat: 31.2012, lng: 121.4328, type: "æ–‡åŒ–å†å²",
                 photo: "https://youimg1.c-ctrip.com/target/100213000000uil6r111F.jpg",
                 desc: "æµ“ç¼©ä¸Šæµ·ç™¾å¹´å†å²çš„'æµ“ç¼©ç‰ˆå¤–æ»©'ï¼Œ37å¤„å†å²å»ºç­‘ä¸æ¢§æ¡æ ‘å½±ç›¸ä¼´ï¼Œå·´é‡‘æ•…å±…ã€æ­¦åº·å¤§æ¥¼è¯‰è¯´åäººå¾€äº‹ã€‚"},
                { name: "ä¸Šæµ·ä½“è‚²é¦†", lat: 31.1853, lng: 121.4376, type: "å…¬å…±ç©ºé—´",
                 photo: "https://ts1.tc.mm.bing.net/th/id/R-C.63f0d3b8822bfa1c91edd9620fcf9390?rik=OG7YDjt2Ga2n9w&riu=http%3a%2f%2fhot.online.sh.cn%2fimages%2fattachement%2fjpeg%2fsite1%2f20161228%2fIMGf48e3894467143288561324.jpeg&ehk=yuw%2b4XbZsXj%2bgCprX5eJ5JrnXpkx9IVW413lsOiFla0%3d&risl=&pid=ImgRaw&r=0",
                 desc: "è§è¯ä¸­å›½ä½“è‚²å‘å±•çš„'ä¸‡ä½“é¦†'ï¼Œå¯å®¹çº³1.8ä¸‡äººçš„åœ†å½¢ç©¹é¡¶å»ºç­‘ï¼Œç°ä¸ºå¤§å‹æ¼”å”±ä¼šä¸ç”µç«èµ›äº‹é¦–é€‰åœºé¦†ã€‚"},
                { name: "å¾æ±‡æ»¨æ±Ÿ", lat: 31.1894, lng: 121.4578, type: "å…¬å…±ç©ºé—´",
                 photo: "https://pic1.zhimg.com/v2-da8fc47df01903f2d1af4f86e87acf55_r.jpg",
                 desc: "é»„æµ¦æ±Ÿç•”çš„'ç¾æœ¯é¦†å¤§é“'ï¼Œé¾™ç¾æœ¯é¦†ã€æ²¹ç½è‰ºæœ¯ä¸­å¿ƒä¸æ»‘æ¿å…¬å›­å…±ç”Ÿï¼Œå·¥ä¸šé—è¿¹æ”¹é€ çš„è·‘æ­¥é“å¹¿å—å¸‚æ°‘å–œçˆ±ã€‚"},
                { name: "è¡¡å±±è·¯é…’å§è¡—", lat: 31.2045, lng: 121.4467, type: "å•†ä¸šä¼‘é—²",
                 photo: "https://life.online.sh.cn/images_quote/attachement/jpg/site1/20230228/IMGfc4dd44975b962755372184.jpg",
                 desc: "æ³•å¼æ¢§æ¡æ©æ˜ çš„å¤œç”Ÿæ´»åœ°æ ‡ï¼Œç™¾å¹´åˆ«å¢…ä¸­çš„çˆµå£«é…’å§ä¸ç½‘çº¢brunchåº—ï¼Œå±•ç°ä¸Šæµ·å°èµ„æƒ…è°ƒçš„æœ€ä½³ä»£è¡¨ã€‚"},
                { name: "ä¸Šæµ·ç”µå½±åšç‰©é¦†", lat: 31.2087, lng: 121.4389, type: "åœ°æ ‡æ™¯ç‚¹",
                 photo: "https://img1.qunarzz.com/travel/d6/1709/f3/e40fde32b71a9eb5.jpg",
                 desc: "ä¸­å›½è§„æ¨¡æœ€å¤§çš„ç”µå½±ä¸»é¢˜åšç‰©é¦†ï¼Œ4Då½±é™¢ä¸æ‰‹æ‘‡æ”¾æ˜ æœºä½“éªŒåŒºå¸¦æ‚¨ç©¿è¶Šç™¾å¹´å½±å²ï¼Œå‘¨ç’‡ç­‰å½±æ˜Ÿæ‰‹ç¨¿çè´µå±•å‡ºã€‚"},
                { name: "å…‰å¯å…¬å›­", lat: 31.1978, lng: 121.4315, type: "å…¬å…±ç©ºé—´",
                 photo: "https://ts1.tc.mm.bing.net/th/id/R-C.fe740385720f1b4dfc72fec4ea943da3?rik=RjOgOX7%2fLwV0Xg&riu=http%3a%2f%2fyouimg1.c-ctrip.com%2ftarget%2ffd%2ftg%2fg6%2fM06%2f3D%2f88%2fCggYslbjwFqAUCeMAAQ3t2hE4rQ601.jpg&ehk=gYiU08pFaf%2f3xp53aJhUPA4%2fAxAoFW%2bwVkVWmKvWZgI%3d&risl=&pid=ImgRaw&r=0",
                 desc: "æ˜ä»£ç§‘å­¦å®¶å¾å…‰å¯å¢“å›­æ”¹å»ºçš„åŸå¸‚å…¬å›­ï¼Œæ¬§æ´²å‡ ä½•å›­æ—ä¸ä¸­å¼ç¢‘å»Šç›¸æ˜ ï¼Œèåˆç§‘å­¦ç²¾ç¥ä¸å¤å…¸ç¾å­¦çš„å¸‚æ°‘ä¼‘æ†©åœ°ã€‚"}
            ];
            
            // ä¿å­˜åˆ°å…¨å±€ï¼Œä¾›æŸ¥è¯¢æ—¶ä½¿ç”¨
            allLocations = locations;
            
            locations.forEach(loc => {
                const iconUrl = icons[loc.type] || icons["åœ°æ ‡æ™¯ç‚¹"];
                const content = `<div class="custom-marker" style="background-image: url('${iconUrl}')"></div>`;
                const marker = new AMap.Marker({
                    position: [loc.lng, loc.lat],
                    content: content,
                    anchor: 'bottom-center',
                    title: loc.name,
                });
                marker.setMap(map);
                marker.on('click', () => {
                    AMap.Popup && AMap.Popup.closeAll();
                    
                    // ç”Ÿæˆå¤©æ°”ä¿¡æ¯
                    const weatherData = generateWeather();
                    
                    // ç”Ÿæˆæ¸¸ç©æ—¶é—´
                    const playTime = generatePlayTime();
                    
                    // å¼¹çª—å†…å®¹
                    const popupContent = `
                        <img src="${loc.photo}" class="info-image" 
                             onerror="this.src='https://dummyimage.com/280x160/eee/999'">
                        <div class="info-title">${loc.name}</div>
                        <div>ç±»å‹ï¼š${loc.type}</div>
                        <div class="info-desc">${loc.desc}</div>
                        <div class="info-weather">
                            ${weatherData.icon} ${weatherData.text} | æ¸©åº¦ï¼š${weatherData.temp}â„ƒ
                        </div>
                        <div>é¢„è®¡æ¸¸ç©ï¼š${playTime}</div>
                    `;

                    new AMap.InfoWindow({
                        content: popupContent,
                        offset: new AMap.Pixel(0, -40),
                        closeWhenClickMap: true
                    }).open(map, marker.getPosition());
                });
            });
           
        }

        // ç”Ÿæˆå¤©æ°”ä¿¡æ¯
        function generateWeather() {
            const weatherList = [
                { icon: "â˜€ï¸", text: "æ™´å¤©ï¼ˆå»ºè®®é˜²æ™’ï¼‰", min: 20, max: 30 },
                { icon: "â›…", text: "å¤šäº‘ï¼ˆé€‚å®œå‡ºè¡Œï¼‰", min: 18, max: 28 },
                { icon: "ğŸŒ§ï¸", text: "å°é›¨ï¼ˆè®°å¾—å¸¦ä¼ï¼‰", min: 15, max: 25 },
                { icon: "ğŸŒ¤ï¸", text: "æ™´è½¬å¤šäº‘", min: 19, max: 27 }
            ];
            const weather = weatherList[Math.floor(Math.random() * weatherList.length)];
            return {
                icon: weather.icon,
                text: weather.text,
                temp: (Math.random() * (weather.max - weather.min) + weather.min).toFixed(1)
            };
        }

        // ç”Ÿæˆæ¸¸ç©æ—¶é—´
        function generatePlayTime() {
            const minutesOptions = [30, 45, 60, 90, 120, 150, 180];
            const minutes = minutesOptions[Math.floor(Math.random() * minutesOptions.length)];
            return minutes < 60 ? 
                `${minutes}åˆ†é’Ÿ` : 
                `${Math.floor(minutes/60)}å°æ—¶${minutes%60 ? `${minutes%60}åˆ†é’Ÿ` : ''}`;
        }

        function generateHeatmapData() {
            // è¿™é‡Œå¯ä»¥æ¨¡æ‹Ÿæ•°æ®å˜åŒ–ï¼Œå®é™…åº”ç”¨ä¸­å¯ä»¥ä»æœåŠ¡å™¨è·å–æ–°æ•°æ®
            return [
               { name: "å¤–æ»©", lng: 121.4904, lat: 31.2415, value: Math.min(100, Math.floor(Math.random() * 120)) },
    { name: "å—äº¬è·¯æ­¥è¡Œè¡—", lng: 121.4752, lat: 31.2356, value: Math.min(100, Math.floor(Math.random() * 120)) },
    { name: "è±«å›­", lng: 121.4873, lat: 31.2279, value: Math.min(100, Math.floor(Math.random() * 120)) },
    { name: "ä¸Šæµ·åšç‰©é¦†", lng: 121.4737, lat: 31.2304, value: Math.min(100, Math.floor(Math.random() * 120)) },
    { name: "äººæ°‘å¹¿åœº", lng: 121.4761, lat: 31.2328, value: Math.min(100, Math.floor(Math.random() * 120)) },
    { name: "ä¸Šæµ·å¤§å‰§é™¢", lng: 121.4756, lat: 31.2319, value: Math.min(100, Math.floor(Math.random() * 120)) },
    { name: "ç”°å­åŠ", lng: 121.4692, lat: 31.2076, value: Math.min(100, Math.floor(Math.random() * 120)) },
    { name: "æ–°å¤©åœ°", lng: 121.4758, lat: 31.2186, value: Math.min(100, Math.floor(Math.random() * 120)) },
    { name: "å¤–ç™½æ¸¡æ¡¥", lng: 121.4911, lat: 31.2442, value: Math.min(100, Math.floor(Math.random() * 75)) },
    { name: "ä¸Šæµ·åŸå¸‚è§„åˆ’é¦†", lng: 121.4742, lat: 31.2341, value: Math.min(100, Math.floor(Math.random() * 120)) },
    { name: "äº‘å—å—è·¯ç¾é£Ÿè¡—", lng: 121.4793, lat: 31.2225, value: Math.min(100, Math.floor(Math.random() * 120)) },
    { name: "æ€å—å…¬é¦†", lng: 121.4708, lat: 31.2143, value: Math.min(100, Math.floor(Math.random() * 120)) },
    { name: "é™å®‰å¯º", lng: 121.4465, lat: 31.2231, value: Math.min(100, Math.floor(Math.random() * 115)) },
    { name: "å—äº¬è¥¿è·¯å•†åœˆ", lng: 121.4598, lat: 31.2309, value: Math.min(100, Math.floor(Math.random() * 120)) },
    { name: "å…´ä¸šå¤ªå¤æ±‡", lng: 121.4602, lat: 31.2287, value: Math.min(100, Math.floor(Math.random() * 120)) },
    { name: "å¼ å›­", lng: 121.4546, lat: 31.2254, value: Math.min(100, Math.floor(Math.random() * 120)) },
    { name: "é©¬å‹’åˆ«å¢…", lng: 121.4519, lat: 31.2332, value: Math.min(100, Math.floor(Math.random() * 100)) },
    { name: "é™å®‰é›•å¡‘å…¬å›­", lng: 121.4501, lat: 31.2278, value: Math.min(100, Math.floor(Math.random() * 120)) },
    { name: "å¤§æ‚¦åŸ", lng: 121.4483, lat: 31.2396, value: Math.min(100, Math.floor(Math.random() * 85)) },
    { name: "å´æ±Ÿè·¯æ­¥è¡Œè¡—", lng: 121.4624, lat: 31.2315, value: Math.min(100, Math.floor(Math.random() * 120)) },
    { name: "ä¸Šæµ·è‡ªç„¶åšç‰©é¦†", lng: 121.4583, lat: 31.2375, value: Math.min(100, Math.floor(Math.random() * 120)) },
    { name: "å¾å®¶æ±‡å•†åœˆ", lng: 121.4380, lat: 31.1956, value: Math.min(100, Math.floor(Math.random() * 120)) },
    { name: "ä¸Šæµ·å›¾ä¹¦é¦†", lng: 121.4412, lat: 31.2098, value: Math.min(100, Math.floor(Math.random() * 110)) },
    { name: "é¾™åå¯º", lng: 121.4493, lat: 31.1729, value: Math.min(100, Math.floor(Math.random() * 75)) },
    { name: "æ­¦åº·è·¯å†å²æ–‡åŒ–è¡—", lng: 121.4328, lat: 31.2012, value: Math.min(100, Math.floor(Math.random() * 110)) },
    { name: "ä¸Šæµ·ä½“è‚²é¦†", lng: 121.4376, lat: 31.1853, value: Math.min(100, Math.floor(Math.random() * 120)) },
    { name: "å¾æ±‡æ»¨æ±Ÿ", lng: 121.4578, lat: 31.1894, value: Math.min(100, Math.floor(Math.random() * 120)) },
    { name: "è¡¡å±±è·¯é…’å§è¡—", lng: 121.4467, lat: 31.2045, value: Math.min(100, Math.floor(Math.random() * 120)) },
    { name: "ä¸Šæµ·ç”µå½±åšç‰©é¦†", lng: 121.4389, lat: 31.2087, value: Math.min(100, Math.floor(Math.random() * 100)) },
    { name: "å…‰å¯å…¬å›­", lng: 121.4315, lat: 31.1978, value: Math.min(100, Math.floor(Math.random() * 100)) }
            ].map(item => ({
                lng: item.lng,
                lat: item.lat,
                count: item.value
            }));
        }

        function refreshHeatmap(AMap) {
            // ç”Ÿæˆæ–°çš„çƒ­åŠ›å›¾æ•°æ®
            const newData = generateHeatmapData();
            
            // æ›´æ–°çƒ­åŠ›å›¾
            heatmap.setDataSet({
                data: newData,
                max: 100
            });
            
            console.log("çƒ­åŠ›å›¾æ•°æ®å·²åˆ·æ–°", new Date());
        }

        // åˆå§‹åŒ–åœ°å›¾
        initMap();
 	
    </script>
</body>
</html>
